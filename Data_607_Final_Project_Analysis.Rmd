---
title: "Data 607 Final Project Analysis"
author: "Mohamed Hassan-El Serafi and Eddie Xu"
date: "2023-05-11"
output: html_document
---

# Introduction

The pressure of winning games can affect the performances of players and their respective teams. For this analysis, we will focus on the performance of players during clutch situations. Clutch is defined as a situation when the game is within 5 points in the final 5 minutes of the game. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(nbastatR)
library(hoopR)
library(ggfortify)
library(DT)
library(caret)
```




```{r}
new_team_csv <- read.csv("https://raw.githubusercontent.com/moham6839/Data607_Final_Project/master/Team_Clutch_Data.csv")
DT::datatable(new_team_csv)
```


```{r}
# split the dataset into regular season and playoff seasons
regular_season_dataset <- new_team_csv %>%
  filter(Season_Type == "Regular Season")

playoff_season_dataset <- new_team_csv %>%
  filter(Season_Type == "Playoffs")
```




## Team Clutch Stats - Regular Season 




```{r}
team_rs_clutch <- regular_season_dataset %>%
  select(TEAM_NAME, PLUS_MINUS, FGM, FGA, FG3M, FG3A, FTM, FTA, GP, W, PTS, REB) %>%
  group_by(TEAM_NAME) %>%
  summarise(total_pm = sum(PLUS_MINUS),
  points_per_game = sum(PTS)/sum(GP),
  total_games = sum(GP),
  total_wins = sum(W),
  total_points = sum(PTS),
  total_rebounds = sum(REB),
  total_fgm = sum(FGM),
  total_fga = sum(FGA),
  total_fgpct = sum(FGM)/sum(FGA),
  total_fg3pct = sum(`FG3M`)/sum(`FG3A`),
  total_ftm = sum(FTM),
  win_pct = sum(W)/sum(GP),
  ft_pct = sum(FTM)/sum(FTA)
  ) %>%
  arrange(desc(total_pm), win_pct)
team_rs_clutch
```



```{r}
ggplot(data=team_rs_clutch, aes(x=reorder(TEAM_NAME, -win_pct), y=win_pct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Team Clutch Win Percentage",
       y="Win Percentage",
       x="Team") +
  coord_flip()
```





```{r}
ggplot(data=team_rs_clutch, aes(x=reorder(TEAM_NAME, -total_pm), y=total_pm)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Team Clutch Plus/Minus",
       y="Plus/Minus",
       x="Team") +
  coord_flip()
```



```{r}
ggplot(data=team_rs_clutch, aes(x=reorder(TEAM_NAME, -total_points), y=total_points)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Total Team Clutch Points",
       y="Total Points",
       x="Team") +
  coord_flip()
```



```{r}
ggplot(data=team_rs_clutch, aes(x=reorder(TEAM_NAME, -total_fgpct), y=total_fgpct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Total Team Field Goal Percentage",
       y="Field Goal Percentage",
       x="Team") +
  coord_flip()
```




```{r}
rs_team_lm <- lm(win_pct ~ total_pm + total_ftm + total_fgm, data=team_rs_clutch)
```


```{r}
summary(rs_team_lm)
```





















## Team Clutch Stats - Playoffs


```{r}
team_playoff_clutch <- playoff_season_dataset %>%
  select(TEAM_NAME, PLUS_MINUS, FGM, FGA, FG3M, FG3A, FTM, FTA, GP, W) %>%
  group_by(TEAM_NAME) %>%
  summarise(total_pm = sum(PLUS_MINUS),
  total_fgpct = sum(FGM)/sum(FGA),
  total_fg3pct = sum(`FG3M`)/sum(`FG3A`),
  win_pct = sum(W)/sum(GP),
  ft_pct = sum(FTM)/sum(FTA)
  ) %>%
  # using filter to remove outlier
  filter(win_pct < 0.8) %>%
  arrange(desc(total_pm), win_pct)
team_playoff_clutch
```


```{r}
team_playoff_clutch <- playoff_season_dataset %>%
  select(TEAM_NAME, PLUS_MINUS, FGM, FGA, FG3M, FG3A, FTM, FTA, GP, W, PTS, REB) %>%
  group_by(TEAM_NAME) %>%
  summarise(total_pm = sum(PLUS_MINUS),
  points_per_game = sum(PTS)/sum(GP),
  total_games = sum(GP),
  total_wins = sum(W),
  total_points = sum(PTS),
  total_rebounds = sum(REB),
  total_fgm = sum(FGM),
  total_fga = sum(FGA),
  total_fgpct = sum(FGM)/sum(FGA),
  total_fg3pct = sum(`FG3M`)/sum(`FG3A`),
  win_pct = sum(W)/sum(GP),
  total_ftm = sum(FTM),
  ft_pct = sum(FTM)/sum(FTA)
  ) %>%
  # using filter to remove outlier
  filter(win_pct < 0.8) %>%
  arrange(desc(total_pm), win_pct)
team_playoff_clutch
```

```{r}
ggplot(data=team_playoff_clutch, aes(x=reorder(TEAM_NAME, -win_pct), y=win_pct)) +
  geom_bar(stat="identity", position="dodge") +theme_minimal() +
  labs(title="NBA Playoff Team Clutch Win Percentage",
       y="Win Percentage",
       x="Team") +
  coord_flip()
```



```{r}
ggplot(data=team_playoff_clutch, aes(x=reorder(TEAM_NAME, -total_pm), y=total_pm)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Team Clutch Plus/Minus",
       y="Plus/Minus",
       x="Team") +
  coord_flip()
```



```{r}
ggplot(data=team_playoff_clutch, aes(x=reorder(TEAM_NAME, -total_fgpct), y=total_fgpct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Team Clutch Field Goal Percentage",
       y="Field Goal Percentage",
       x="Team") +
  coord_flip()
```



```{r}
ggplot(data=team_playoff_clutch, aes(x=reorder(TEAM_NAME, -total_points), y=total_points)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Team Clutch Total Points ",
       y="Total Points",
       x="Team") +
  coord_flip()
```


```{r}
playoff_team_lm <- lm(win_pct ~ total_pm + total_ftm + total_fgm, data=team_playoff_clutch)
```


```{r}
summary(playoff_team_lm)
```






## Player Clutch Data - Regular Season




```{r}
new_player_csv <- read.csv("https://raw.githubusercontent.com/moham6839/Data607_Final_Project/master/Player_Clutch_Data.csv")
head(new_player_csv)
```


```{r}
regular_season_player_dataset <- new_player_csv %>%
  filter(Season_Type == "Regular Season")
```


```{r}
regular_season_player_dataset
```






```{r}
rs_clutch_player <- regular_season_player_dataset %>%
  select(PLAYER_NAME, PLUS_MINUS, FGM, FGA, FG3M, FG3A, FTM, FTA, GP, W, PTS, REB) %>%
  group_by(PLAYER_NAME) %>%
  summarise(total_pm = sum(PLUS_MINUS),
  points_per_game = sum(PTS)/sum(GP),
  total_games = sum(GP),
  total_wins = sum(W),
  total_points = sum(PTS),
  total_rebounds = sum(REB),
  total_fgm = sum(FGM),
  total_fga = sum(FGA),
  total_fgpct = sum(FGM)/sum(FGA),
  total_fg3pct = sum(`FG3M`)/sum(`FG3A`),
  win_pct = sum(W)/sum(GP),
  ft_pct = sum(FTM)/sum(FTA)
  ) %>%
  arrange(desc(total_pm), win_pct)
DT::datatable(rs_clutch_player)
```


```{r}
summary(rs_clutch_player)
```




```{r}
ggplot(data=rs_clutch_player[1:20, ], aes(x=reorder(PLAYER_NAME, -total_pm), y=total_pm)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Player Clutch Plus/Minus",
       y="Total Plus/Minus",
       x="Player") +
  coord_flip()
```


```{r}
ggplot(data=rs_clutch_player[1:20, ], aes(x=reorder(PLAYER_NAME, -win_pct), y=win_pct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Player Clutch Win Percentage",
       y="Win Percentage",
       x="Player") +
  coord_flip()
```








```{r}
ggplot(data=rs_clutch_player[1:20, ], aes(x=reorder(PLAYER_NAME, -total_wins), y=total_wins)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Player Clutch Total Wins",
       y="Total Wins",
       x="Player") +
  coord_flip()
```


```{r}
ggplot(data=rs_clutch_player[1:20, ], aes(x=reorder(PLAYER_NAME, -total_fgpct), y=total_fgpct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Regular Season Player Clutch Field Goal Percentage",
       y="Field Goal Percentage",
       x="Player") +
  coord_flip()
```










```{r}
rs_player_lm <- lm(total_wins ~ total_pm + total_fgm  + total_rebounds + total_points, data=rs_clutch_player)
```



```{r}
summary(rs_player_lm)
```











## Player Clutch Data Playoffs



```{r}
playoff_season_player_dataset <- new_player_csv %>%
  filter(Season_Type == "Playoffs")
```








```{r}
playoff_performers <- playoff_season_player_dataset %>%
  select(PLAYER_NAME, PLUS_MINUS, FGM, FGA, FG3M, FG3A, FTM, FTA, GP, W, PTS, REB) %>%
  group_by(PLAYER_NAME) %>%
  summarise(total_plus_minus = sum(PLUS_MINUS),
  total_points = sum(PTS),
  points_per_game = sum(PTS)/sum(GP),
  total_wins = sum(W),
  total_rebounds = sum(REB),
  total_fgm = sum(FGM),
  total_fga = sum(FGA),
  total_fg3m = sum(FG3M),
  total_fgpct = sum(FGM)/sum(FGA),
  total_fg3pct = sum(`FG3M`)/sum(`FG3A`),
  win_pct = sum(W)/sum(GP),
  total_ftm = sum(FTM),
  total_fta = sum(FTA),
  ft_pct = sum(FTM)/sum(FTA)
  ) %>%
  arrange(desc(total_plus_minus), win_pct)
DT::datatable(playoff_performers)
```



```{r}
ggplot(data=playoff_performers[1:20, ], aes(x=reorder(PLAYER_NAME, -total_plus_minus), y=total_plus_minus)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Plus/Minus",
       y="Plus/Minus",
       x="Player") +
  coord_flip()
```


```{r}
ggplot(data=playoff_performers[494:514, ], aes(x=reorder(PLAYER_NAME, total_plus_minus), y=total_plus_minus)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Plus/Minus",
       y="Plus/Minus",
       x="Player") +
  coord_flip()
```










```{r}
ggplot(data=playoff_performers[1:20, ], aes(x=reorder(PLAYER_NAME, -win_pct), y=win_pct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Win Percentage",
       y="Win Percentage",
       x="Player") +
  coord_flip()
```


```{r}
ggplot(data=playoff_performers[494:514, ], aes(x=reorder(PLAYER_NAME, -win_pct), y=win_pct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Win Percentage",
       y="Win Percentage",
       x="Player") +
  coord_flip()
```





```{r}
ggplot(data=playoff_performers[1:20, ], aes(x=reorder(PLAYER_NAME, -total_fgpct), y=total_fgpct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Field Goal Percentage",
       y="Field Goal Percentage",
       x="Player") +
  coord_flip()
```




```{r}
ggplot(data=playoff_performers[494:514, ], aes(x=reorder(PLAYER_NAME, -total_fgpct), y=total_fgpct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Field Goal Percentage",
       y="Field Goal Percentage",
       x="Player") +
  coord_flip()
```






```{r}
ggplot(data=playoff_performers[1:20, ], aes(x=reorder(PLAYER_NAME, -ft_pct), y=ft_pct)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Free Throw Percentage",
       y="Free Throw Percentage",
       x="Player") +
  coord_flip()
```


```{r}
ggplot(data=playoff_performers[1:20, ], aes(x=reorder(PLAYER_NAME, -total_points), y=total_points)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Points",
       y="Points",
       x="Player") +
  coord_flip()
```

```{r}
ggplot(data=playoff_performers[1:20, ], aes(x=reorder(PLAYER_NAME, -points_per_game), y=points_per_game)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Points Per Game",
       y="Points Per Game",
       x="Player") +
  coord_flip()
```






```{r}
ggplot(data=playoff_performers[494:514, ], aes(x=reorder(PLAYER_NAME, total_plus_minus), y=total_plus_minus)) +
  geom_bar(stat="identity", position="dodge") +
  theme_minimal() +
  labs(title="NBA Playoffs Player Clutch Plus/Minus",
       y="Plus/Minus",
       x="Player") +
  coord_flip()
```







```{r}
( lr.out <- glm(`win_pct` ~ total_plus_minus, data = playoff_performers, family = binomial(link = 'logit')) )
```




```{r}
playoff_player_lm <- lm(win_pct ~ total_plus_minus + total_fgm  + total_ftm + total_rebounds + total_points, data=playoff_performers)
```









```{r}
summary(playoff_player_lm)
```


```{r}
ggplot(data=playoff_performers, aes(playoff_player_lm$residuals)) +
geom_histogram(binwidth = 1, color = "black", fill = "purple4") +
theme(panel.background = element_rect(fill = "white"),
axis.line.x=element_line(),
axis.line.y=element_line()) +
ggtitle("Histogram for Model Residuals")
```



```{r}
ggplot(data = playoff_performers, aes(x = total_plus_minus, y = total_wins)) +
geom_point() +
stat_smooth(method = "lm", col = "dodgerblue3") +
theme(panel.background = element_rect(fill = "white"),
axis.line.x=element_line(),
axis.line.y=element_line()) +
ggtitle("Linear Model Fitted to Data")
```



```{r}
model <- train(total_wins ~ total_plus_minus,
               data = playoff_performers,
               method = "lm")
```





```{r}
player_lm <- lm(`win_pct` ~ `total_plus_minus`, data=playoff_performers)
```



```{r}
summary(player_lm)
```











